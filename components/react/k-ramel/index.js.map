{"version":3,"file":"index.js","sources":["src/hoc.jsx","src/link/link.jsx","src/link/link.container.js","src/driver.js"],"sourcesContent":["import React from 'react'\n\nconst getDisplayName = Component => `router(${\n  Component.displayName\n  || Component.name\n  || (Component.constructor && Component.constructor.name)\n  || 'Unknown'\n})`\n\nconst isRouteFound = code => result => result && [].concat(code).includes(result.code)\n\nconst hoc = (code, options) => Component => class extends React.Component {\n  static displayName = getDisplayName(Component)\n\n  static contextTypes = {\n    store: () => null, // this is to avoid importing prop-types\n  }\n\n  constructor(props, context) {\n    super(props, context)\n\n    this.state = { show: false }\n  }\n\n  componentWillMount() {\n    // subscribe\n    this.unsubscribe = this.context.store.subscribe(() => {\n      this.toShow()\n    })\n\n    // run in once\n    this.toShow()\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe()\n  }\n\n  toShow = () => {\n    const state = this.context.store.getState()\n\n    // TODO: hardcoded path (state.ui)\n    if (!state.ui.router || !state.ui.router.result) {\n      // eslint-disable-next-line no-console\n      console.error('[k-redux-router] | There is no route found in `state.ui.router.result`')\n      return\n    }\n\n    // Absolute mode, we are looking in top level only\n    let currentRoute = state.ui.router.result.route\n    if (options && options.absolute) { // TODO: absolute mode is forcer\n      const show = (code === currentRoute.code)\n      if (show !== this.state.show) {\n        this.setState(innerState => ({ ...innerState, show }))\n      }\n\n      return\n    }\n\n    // Either way we are looking top down the result tree\n    let show = (code === currentRoute.code)\n    while (currentRoute && currentRoute.parent && !show) {\n      currentRoute = state.ui.router.routes.map[currentRoute.parent]\n      show = (code === currentRoute.code)\n    }\n\n    if (show !== this.state.show) {\n      this.setState(innerState => ({ ...innerState, show }))\n    }\n  }\n\n  render() {\n    if (!this.state.show) return null\n\n    return <Component {...this.props} />\n  }\n}\n\nhoc.absolute = (code, options) => hoc(code, { ...options, absolute: true })\n\nexport default hoc\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst Link = (props) => {\n  const {\n    href,\n    onClick,\n    ...params,\n  } = props\n\n  const {\n    className,\n    children\n  } = params\n\n  // TODO: factorise code from middleware and from here\n  let queryPart = ''\n  let processedHref = href.base\n  if (href.compiled) processedHref = href.compiled(params.path)\n  if (params.query) queryPart = `?${toQueryString(params.query)}`\n  processedHref = `${processedHref}${queryPart}`\n\n  return (\n    <a\n      className={className}\n      href={processedHref}\n      onClick={onClick}\n    >\n      {children}\n    </a>\n  )\n}\n\nLink.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.node,\n  href: PropTypes.string,\n  onClick: PropTypes.func,\n}\n\nLink.defaultProps = {\n  className: undefined,\n  children: undefined,\n  href: undefined,\n  onClick: undefined,\n}\n\nexport default Link\n","import { inject } from '@k-ramel/react'\nimport Component from './link'\n\n// copied from redux-little-router\n// - this part is about letting user make CTRL+CLICK (example)\n// - but keep the push-history-api available when we do a simple click\nconst LEFT_MOUSE_BUTTON = 0\nconst isNotLeftClick = e => e.button && e.button !== LEFT_MOUSE_BUTTON\nconst hasModifier = e => !!(e.shiftKey || e.altKey || e.metaKey || e.ctrlKey)\nconst shouldIgnoreClick = e => hasModifier(e) || isNotLeftClick(e) || e.defaultPrevented\n\n// map store\nconst mapStore = (store, { onClick, code, query, ...params }, { router }) => ({\n  href: store.getState().ui.router.routes.map[code],\n  onClick: (e) => {\n    // parent onClick callback\n    if (onClick) onClick(e)\n\n    // from redux-little-router\n    if (shouldIgnoreClick(e)) return\n\n    // dispatch the push\n    store.dispatch(store.ui.router.push(code, params, query)) // TODO: path is hardcoded (state.ui)\n\n    // prevent default behaviour\n    e.preventDefault()\n  },\n})\n\nexport default inject(mapStore)(Component)\n","// TODO: maybe add it to driver in k-ramel instead\nexport default () => { console.log('DRIVER TODO [k-redux-router]') }\n"],"names":["hoc","code","options","props","context","toShow","state","_this","store","getState","ui","router","result","currentRoute","route","absolute","show","setState","innerState","parent","routes","map","error","React","Component","unsubscribe","this","subscribe","displayName","name","constructor","getDisplayName","contextTypes","Link","href","onClick","params","className","children","queryPart","processedHref","base","compiled","path","query","toQueryString","propTypes","PropTypes","string","node","func","defaultProps","undefined","inject","e","shiftKey","altKey","metaKey","ctrlKey","hasModifier","button","isNotLeftClick","defaultPrevented","shouldIgnoreClick","dispatch","push","preventDefault","log"],"mappings":"qsCAWMA,EAAM,SAACC,EAAMC,UAAY,sDAOjBC,EAAOC,4EACXD,EAAOC,aAmBfC,OAAS,eACDC,EAAQC,EAAKH,QAAQI,MAAMC,cAG5BH,EAAMI,GAAGC,QAAWL,EAAMI,GAAGC,OAAOC,YAOrCC,EAAeP,EAAMI,GAAGC,OAAOC,OAAOE,SACtCZ,GAAWA,EAAQa,cACfC,EAAQf,IAASY,EAAaZ,KAChCe,IAAST,EAAKD,MAAMU,QACjBC,SAAS,wBAAoBC,GAAYF,wBAO9CA,EAAQf,IAASY,EAAaZ,KAC3BY,GAAgBA,EAAaM,SAAWH,KAC9BV,EAAMI,GAAGC,OAAOS,OAAOC,IAAIR,EAAaM,UAC/ClB,IAASY,EAAaZ,KAG5Be,IAAST,EAAKD,MAAMU,QACjBC,SAAS,wBAAoBC,GAAYF,yBAvBtCM,MAAM,6EAvBXhB,OAAUU,MAAM,wUAViCO,EAAMC,2EAevDC,YAAcC,KAAKtB,QAAQI,MAAMmB,UAAU,aACzCtB,gBAIFA,6DAIAoB,sDAqCAC,KAAKpB,MAAMU,KAETO,gBAACC,EAAcE,KAAKvB,OAFE,gBA5DxByB,YAVc,6BACrBJ,EAAUI,aACPJ,EAAUK,MACTL,EAAUM,aAAeN,EAAUM,YAAYD,MAChD,eAMkBE,CAAeP,KAE7BQ,oBACE,kBAAM,WA+DjBhC,EAAIe,SAAW,SAACd,EAAMC,UAAYF,EAAIC,OAAWC,GAASa,UAAU,MC3EpE,IAAMkB,EAAO,SAAC9B,OAEV+B,EAGE/B,EAHF+B,KACAC,EAEEhC,EAFFgC,QACGC,IACDjC,sBAGFkC,EAEED,EAFFC,UACAC,EACEF,EADFE,SAIEC,EAAY,GACZC,EAAgBN,EAAKO,YACrBP,EAAKQ,WAAUF,EAAgBN,EAAKQ,SAASN,EAAOO,OACpDP,EAAOQ,QAAOL,MAAgBM,cAAcT,EAAOQ,aACpCJ,EAAgBD,EAGjChB,+BACac,OACLG,UACGL,OAOfF,EAAKa,qBACQC,EAAUC,gBACXD,EAAUE,UACdF,EAAUC,eACPD,EAAUG,MAGrBjB,EAAKkB,6BACQC,gBACDA,YACJA,eACGA,GCtCX,MAuBeC,SAjBE,SAAC7C,WAAS2B,IAAAA,QAASlC,IAAAA,KAAM2C,IAAAA,MAAUR,oCAAYzB,mBACxDH,EAAMC,WAAWC,GAAGC,OAAOS,OAAOC,IAAIpB,WACnC,SAACqD,GAEJnB,GAASA,EAAQmB,GAPC,mBADN,qBAAQA,EAAEC,UAAYD,EAAEE,QAAUF,EAAEG,SAAWH,EAAEI,SACtCC,CAAYL,IAFpB,mBAAKA,EAAEM,QADJ,IACcN,EAAEM,OAEOC,CAAeP,IAAMA,EAAEQ,iBAUhEC,CAAkBT,OAGhBU,SAASxD,EAAME,GAAGC,OAAOsD,KAAKhE,EAAMmC,EAAQQ,MAGhDsB,qBAISb,CAAiB7B,+BC5BD2C,IAAI"}