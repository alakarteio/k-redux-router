import{router,selectors,actions}from"@k-redux-router/core";import{applyMiddleware}from"k-ramel";import React from"react";import PropTypes from"prop-types";import{inject}from"@k-ramel/react";var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u,c=e[Symbol.iterator]();!(n=(u=c.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),driver=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.routes,r=e.path,n=void 0===r?"ui.router":r,o=e.getState,i=void 0===o?function(e){return e.ui.router}:o,u=router(t,{getState:i}),c=u.middleware,a=u.reducer,s=u.init;return{getDriver:function(e){return _extends({},Object.entries(actions).reduce(function(t,r){var n=slicedToArray(r,2),o=n[0],i=n[1];return _extends({},t,defineProperty({},o,function(){return e.dispatch(i.apply(void 0,arguments))}))},{}),Object.entries(selectors(i)).reduce(function(t,r){var n=slicedToArray(r,2),o=n[0],i=n[1],u=function(){return i(e.getState())};return["getRoute","getPathParam","getQueryParam","getParam"].includes(o)&&(u=function(){return i.apply(void 0,arguments)(e.getState())}),_extends({},t,defineProperty({},o,u))},{}))},getReducer:function(){return{path:n,reducer:a}},getEnhancer:function(){return applyMiddleware(c)},init:function(e){e.dispatch(s())}}},getDisplayName=function(e){return"router("+(e.displayName||e.name||e.constructor&&e.constructor.name||"Unknown")+")"},hoc=function(e,t){return function(r){var n,o;return o=n=function(n){function o(r,n){classCallCheck(this,o);var i=possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,r,n));return i.toShow=function(){var r=i.context.store.drivers.router;if(r.getState()&&r.getResult()){var n=r.getCurrentRoute();if(t&&t.absolute){var o=e===n.code;o!==i.state.show&&i.setState(function(e){return _extends({},e,{show:o})})}else{for(var u=e===n.code;n&&n.parent&&!u;)n=r.getRoute(n.parent),u=e===n.code;u!==i.state.show&&i.setState(function(e){return _extends({},e,{show:u})})}}else console.error("[k-redux-router] | There is no route found in `state.ui.router.result`")},i.state={show:!1},i}return inherits(o,n),createClass(o,[{key:"componentWillMount",value:function(){var e=this;this.unsubscribe=this.context.store.subscribe(function(){e.toShow()}),this.toShow()}},{key:"componentWillUnmount",value:function(){this.unsubscribe()}},{key:"render",value:function(){return this.state.show?React.createElement(r,this.props):null}}]),o}(React.Component),n.displayName=getDisplayName(r),n.contextTypes={store:function(){return null}},o}};hoc.absolute=function(e,t){return hoc(e,_extends({},t,{absolute:!0}))};var toQueryString=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},Link=function(e){var t=e.href,r=e.onClick,n=objectWithoutProperties(e,["href","onClick"]),o=n.className,i=n.children,u="",c=t.base;return t.compiled&&(c=t.compiled(n)),n.query&&(u="?"+toQueryString(n.query)),c=""+c+u,React.createElement("a",{className:o,href:c,onClick:r},i)};Link.propTypes={className:PropTypes.string,children:PropTypes.node,href:PropTypes.shape({base:PropTypes.string,compiled:PropTypes.func}),onClick:PropTypes.func},Link.defaultProps={className:void 0,children:void 0,href:void 0,onClick:void 0};var LEFT_MOUSE_BUTTON=0,isNotLeftClick=function(e){return e.button&&e.button!==LEFT_MOUSE_BUTTON},hasModifier=function(e){return!!(e.shiftKey||e.altKey||e.metaKey||e.ctrlKey)},shouldIgnoreClick=function(e){return hasModifier(e)||isNotLeftClick(e)||e.defaultPrevented},mapStore=function(e,t,r){var n=t.onClick,o=t.code,i=t.query,u=objectWithoutProperties(t,["onClick","code","query"]),c=r.router;return{href:c.getRoute(o).href,onClick:function(e){n&&n(e),shouldIgnoreClick(e)||(c.push(o,u,i),e.preventDefault())}}},link_container=inject(mapStore)(Link);export{driver as router,hoc as forRoute,link_container as Link};
