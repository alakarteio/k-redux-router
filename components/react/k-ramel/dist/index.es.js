import{router,selectors,actions}from"@k-redux-router/core";import{applyMiddleware}from"k-ramel";import React from"react";import PropTypes from"prop-types";import{inject}from"@k-ramel/react";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var r,o,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var driver=(e={})=>{const{routes:t,path:r="ui.router",getState:o=(e=>e.ui.router)}=e,{middleware:n,reducer:i,init:s}=router(t,{getState:o});return{getDriver:e=>_objectSpread({},Object.entries(actions).reduce((t,[r,o])=>_objectSpread({},t,{[r]:(...t)=>e.dispatch(o(...t))}),{}),Object.entries(selectors(o)).reduce((t,[r,o])=>{let n=()=>o(e.getState());return["getRoute","getPathParam","getQueryParam","getParam"].includes(r)&&(n=((...t)=>o(...t)(e.getState()))),_objectSpread({},t,{[r]:n})},{})),getReducer:()=>({path:r,reducer:i}),getEnhancer:()=>applyMiddleware(n),init:e=>{e.dispatch(s())}}};const getDisplayName=e=>`router(${e.displayName||e.name||e.constructor&&e.constructor.name||"Unknown"})`,hoc=(e,t)=>r=>{var o,n;return n=o=class extends React.Component{constructor(r,o){super(r,o),_defineProperty(this,"toShow",()=>{const{store:r}=this.context,{router:o}=r.drivers;if(!o.getState()||!o.getResult())return void console.error("[k-redux-router] | There is no route found in `state.ui.router.result`");if(!o.isFound()){const e=t&&t.notFound;return void this.setState(t=>_objectSpread({},t,{show:e}))}const n=[].concat(e);let i=o.getCurrentRoute();if(t&&t.absolute){const e=n.includes(i.code);return void(e!==this.state.show&&this.setState(t=>_objectSpread({},t,{show:e})))}let s=n.includes(i.code);for(;i&&i.parent&&!s;)i=o.getRoute(i.parent),s=n.includes(i.code);s!==this.state.show&&this.setState(e=>_objectSpread({},e,{show:s}))}),this.state={show:!1}}componentWillMount(){const{store:e}=this.context;this.unsubscribe=e.subscribe(()=>{this.toShow()}),this.toShow()}componentWillUnmount(){this.unsubscribe()}render(){const{show:e}=this.state;return e?React.createElement(r,this.props):null}},_defineProperty(o,"displayName",getDisplayName(r)),_defineProperty(o,"contextTypes",{store:()=>null}),n};hoc.absolute=((e,t)=>hoc(e,_objectSpread({},t,{absolute:!0}))),hoc.notFound=(e=>hoc(void 0,_objectSpread({},e,{notFound:!0})));const toQueryString=e=>Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&"),Link=e=>{const{href:t,onClick:r}=e,o=_objectWithoutProperties(e,["href","onClick"]),{className:n,children:i}=o;if(void 0===t)return null;let s="",c=t;return t.base&&(c=t.base),t.compiled&&(c=t.compiled(o)),o.query&&(s=`?${toQueryString(o.query)}`),c=`${c}${s}`,React.createElement("a",{className:n,href:c,onClick:r},i)};Link.propTypes={className:PropTypes.string,children:PropTypes.node,href:PropTypes.oneOfType([PropTypes.string,PropTypes.shape({base:PropTypes.string,compiled:PropTypes.func})]),onClick:PropTypes.func},Link.defaultProps={className:void 0,children:void 0,href:void 0,onClick:void 0};const LEFT_MOUSE_BUTTON=0,isNotLeftClick=e=>e.button&&0!==e.button,hasModifier=e=>!!(e.shiftKey||e.altKey||e.metaKey||e.ctrlKey),shouldIgnoreClick=e=>hasModifier(e)||isNotLeftClick(e)||e.defaultPrevented,mapStore=(e,t,{router:r})=>{let{onClick:o,code:n,query:i}=t,s=_objectWithoutProperties(t,["onClick","code","query"]);return{href:s.href||r.getRoute(n)&&r.getRoute(n).href,onClick:e=>{o&&o(e),shouldIgnoreClick(e)||(r.push(n,s,i),e.preventDefault())}}};var link_container=inject(mapStore)(Link);export{driver as router,hoc as forRoute,link_container as Link};
