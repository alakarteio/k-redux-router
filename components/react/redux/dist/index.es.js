import e from"react";import{selectors as t,actions as o}from"@k-redux-router/core";import{connect as r}from"react-redux";import n from"prop-types";function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){s(e,t,o[t])})}return e}function u(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)o=s[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}const i=(o,r={})=>n=>{var u,i;const{getState:l=(e=>e.ui.router),absolute:a=!1}=r,{getResult:d,getRoute:f,getCurrentRoute:p,isFound:h}=t(l);return i=u=class extends e.Component{constructor(e,t){super(e,t),s(this,"toShow",()=>{const{store:e}=this.context,t=e.getState();if(!l(t)||!d(t))return void console.error("[k-redux-router] | There is no route found in `state.ui.router.result`");if(!h(t)){const e=r&&r.notFound;return void this.setState(t=>c({},t,{show:e}))}const n=[].concat(o);let s=p(t);if(a){const e=n.includes(s.code);return void(e!==this.state.show&&this.setState(t=>c({},t,{show:e})))}let u=n.includes(s.code);for(;s&&s.parent&&!u;)s=f(s.parent)(t),u=n.includes(s.code);u!==this.state.show&&this.setState(e=>c({},e,{show:u}))}),this.state={show:!1}}componentWillMount(){const{store:e}=this.context;this.unsubscribe=e.subscribe(()=>{this.toShow()}),this.toShow()}componentWillUnmount(){this.unsubscribe()}render(){const{show:t}=this.state;return t?e.createElement(n,this.props):null}},s(u,"displayName",(e=>`router(${e.displayName||e.name||e.constructor&&e.constructor.name||"Unknown"})`)(n)),s(u,"contextTypes",{store:()=>null}),i};i.absolute=((e,t)=>i(e,c({},t,{absolute:!0}))),i.notFound=(e=>i(void 0,c({},e,{notFound:!0})));const l=t=>{const{href:o,onClick:r}=t,n=u(t,["href","onClick"]),{className:s,children:c}=n;if(void 0===o)return null;let i="",l=o;return o.base&&(l=o.base),o.compiled&&(l=o.compiled(n)),n.query&&(i=`?${(e=>Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&"))(n.query)}`),l=`${l}${i}`,e.createElement("a",{className:s,href:l,onClick:r},c)};l.propTypes={className:n.string,children:n.node,href:n.oneOfType([n.string,n.shape({base:n.string,compiled:n.func})]),onClick:n.func},l.defaultProps={className:void 0,children:void 0,href:void 0,onClick:void 0};const{getRoute:a}=t(e=>e.ui.router);var d=r((e,{code:t})=>({href:a(t)(e).href}),(e,t)=>{let{onClick:r,code:n,query:s}=t,c=u(t,["onClick","code","query"]);return{onClick:t=>{r&&r(t),(e=>(e=>!!(e.shiftKey||e.altKey||e.metaKey||e.ctrlKey))(e)||(e=>e.button&&0!==e.button)(e)||e.defaultPrevented)(t)||(e(o.push(n,c,s)),t.preventDefault())}}})(l);export{d as Link,i as forRoute};
