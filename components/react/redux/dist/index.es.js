import React from"react";import{selectors,actions}from"@k-redux-router/core";import PropTypes from"prop-types";import{connect}from"react-redux";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,o[t])})}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var o,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)o=s[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}const getDisplayName=e=>`router(${e.displayName||e.name||e.constructor&&e.constructor.name||"Unknown"})`,hoc=(e,t={})=>o=>{var r,n;const{getState:s=(e=>e.ui.router),absolute:c=!1}=t,{getResult:i,getRoute:u,getCurrentRoute:a,isFound:p}=selectors(s);return n=r=class extends React.Component{constructor(o,r){super(o,r),_defineProperty(this,"toShow",()=>{const{store:o}=this.context,r=o.getState();if(!s(r)||!i(r))return void console.error("[k-redux-router] | There is no route found in `state.ui.router.result`");if(!p(r)){const e=t&&t.notFound;return void this.setState(t=>_objectSpread({},t,{show:e}))}const n=[].concat(e);let l=a(r);if(c){const e=n.includes(l.code);return void(e!==this.state.show&&this.setState(t=>_objectSpread({},t,{show:e})))}let d=n.includes(l.code);for(;l&&l.parent&&!d;)l=u(l.parent)(r),d=n.includes(l.code);d!==this.state.show&&this.setState(e=>_objectSpread({},e,{show:d}))}),this.state={show:!1}}componentWillMount(){const{store:e}=this.context;this.unsubscribe=e.subscribe(()=>{this.toShow()}),this.toShow()}componentWillUnmount(){this.unsubscribe()}render(){const{show:e}=this.state;return e?React.createElement(o,this.props):null}},_defineProperty(r,"displayName",getDisplayName(o)),_defineProperty(r,"contextTypes",{store:()=>null}),n};hoc.absolute=((e,t)=>hoc(e,_objectSpread({},t,{absolute:!0}))),hoc.notFound=(e=>hoc(void 0,_objectSpread({},e,{notFound:!0})));const toQueryString=e=>Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&"),Link=e=>{const{href:t,onClick:o}=e,r=_objectWithoutProperties(e,["href","onClick"]),{className:n,children:s}=r;if(void 0===t)return null;let c="",i=t;return t.base&&(i=t.base),t.compiled&&(i=t.compiled(r)),r.query&&(c=`?${toQueryString(r.query)}`),i=`${i}${c}`,React.createElement("a",{className:n,href:i,onClick:o},s)};Link.propTypes={className:PropTypes.string,children:PropTypes.node,href:PropTypes.oneOfType([PropTypes.string,PropTypes.shape({base:PropTypes.string,compiled:PropTypes.func})]),onClick:PropTypes.func},Link.defaultProps={className:void 0,children:void 0,href:void 0,onClick:void 0};const LEFT_MOUSE_BUTTON=0,isNotLeftClick=e=>e.button&&0!==e.button,hasModifier=e=>!!(e.shiftKey||e.altKey||e.metaKey||e.ctrlKey),shouldIgnoreClick=e=>hasModifier(e)||isNotLeftClick(e)||e.defaultPrevented,{getRoute:getRoute}=selectors(e=>e.ui.router),mapState=(e,{code:t})=>({href:getRoute(t)(e).href}),mapDispatch=(e,t)=>{let{onClick:o,code:r,query:n}=t,s=_objectWithoutProperties(t,["onClick","code","query"]);return{onClick:t=>{o&&o(t),shouldIgnoreClick(t)||(e(actions.push(r,s,n)),t.preventDefault())}}};var link_container=connect(mapState,mapDispatch)(Link);export{hoc as forRoute,link_container as Link};
