var r,e,t,n,o=(r=require("path-to-regexp"))&&"object"==typeof r&&"default"in r?r.default:r,u=function(r){return function(e,t,n){return{type:r,payload:{code:e,params:{path:t,query:n}}}}},i={push:u("@@router/PUSH"),replace:u("@@router/REPLACE"),goBack:function(r){return void 0===r&&(r=1),{type:"@@router/GO_BACK",payload:r}}},a=function(r){return{type:"@@router/ROUTE_FOUND",payload:Object.assign({found:!0},r)}},c=function(r){return function(t){if(window&&window.location&&window.location.pathname){var n,o=r.getState(t.getState()).routes.array.find(function(r){return!!(n=r.href.regexp.exec(window.location.pathname))});n=o.href.parsed.map(function(r){return r.name}).filter(Boolean).reduce(function(r,t,o){return Object.assign(((e={})[t]=n[o+1],e),r)},{}),t.dispatch(a({route:o,params:{path:n,query:function(){var r=window.location;if(r.search.length<2)return{};var e=r.search.substring(1);return JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}()}}))}}},s=function(r){return function(e){return function(t){var n,o=t.type,u=t.payload;switch(o){case"@@router/GO_BACK":return void window.history.go(-1*u);case"@@router/REPLACE":case"@@router/PUSH":var i=u.code,c=u.params,s=r.getState(e.getState()).routes.map[i];if(s){var f=s.href,d="",p=f.base;f.compiled&&(p=f.compiled(c.path)),c.query&&(d="?"+(n=c.query,Object.keys(n).map(function(r){return encodeURIComponent(r)+"="+encodeURIComponent(n[r])}).join("&"))),p=""+p+d,"@@router/PUSH"===o?window.history.pushState(void 0,void 0,p):window.history.replaceState(void 0,void 0,p)}return a({route:s,params:c});default:return}}}};function f(r){var e=function(e){return function(t){return r(t).routes.map[e]}},t=function(e){return r(e).result},n=function(r){return t(r).params},o=function(r){return n(r).path},u=function(r){return n(r).query},i=function(r){return function(e){return o(e)[r]}},a=function(r){return function(e){return u(e)[r]}};return{getState:r,getRoute:e,getResult:t,getCurrentCode:function(r){return e(r).code},getCurrentRoute:function(r){return t(r).route},isFound:function(r){return t(r).found},getParams:n,getPathParams:o,getQueryParams:u,getPathParam:i,getQueryParam:a,getParam:function(r){return function(e){return i(r)(e)||a(r)(e)}}}}function d(){return{type:"@@router/INIT"}}var p=function(r){return"object"==typeof r&&r.code},l=function(r){var e=[],n=function(r,u,i){var a={};u&&(a=Object.entries(u).filter(function(r){return!p(r[1])}).reduce(function(r,e){return Object.assign(r,((t={})[e[0]]=e[1],t))},{}));var c=i;u&&(c=Object.assign(a,i,{parent:u&&u.code,href:{base:r,compiled:r.includes(":")?o.compile(r):void 0,regexp:o(r),parsed:o.parse(r)}}),e.push(c)),Object.entries(i).filter(function(r){return p(r[1])}).forEach(function(e){var t=e[1];return n([r,e[0]].join("").replace("//","/"),c,t)})};return n("",void 0,r),e.forEach(function(r){Object.entries(r).forEach(function(e){var t=e[0],n=e[1],o=n;p(n)&&(o=n.code),r[t]=o})}),e};exports.actions=i,exports.default=function(r,e){void 0===e&&(e={});var t=e.history;if(!t&&window&&window.history&&(t=window.history),!t)throw new Error("[k-redux-router] no history implementation is given");var o={array:l(r)};o.map=o.array.reduce(function(r,e){return Object.assign({},r,((n={})[e.code]=e,n))},{});var u=function(r,e){var t=Object.assign({},{routes:r,result:{found:!1}}),n=function(r,e){void 0===r&&(r=t),void 0===e&&(e={});var n=e.payload;switch(e.type){case"@@router/ROUTE_FOUND":return Object.assign({},r,{result:n});default:return r}};return Object.assign(n,f(e.getState||function(r){return r.ui.router})),Object.assign(n,i),n}(o,e);return{middleware:function(r,e,t){var n=!1,o=c(t),u=s(t);return function(r){return function(e){return function(t){if(!t.type||!t.type.startsWith("@@router/"))return e(t);var i=e(t);"@@router/INIT"===t.type&&(o(r),n?console.warn("[k-redux-router] initialized twice"):(n=!0,window.onpopstate=function(){o(r)})),n||"@@router/ROUTE_FOUND"===t.type||console.warn("[k-redux-router] router should be initialized");var a=u(r)(t);return a&&r.dispatch(a),i}}}}(0,0,u),reducer:u,init:d}},exports.selectors=f;
//# sourceMappingURL=index.js.map
