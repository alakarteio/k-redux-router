import r from"path-to-regexp";var e,t,n,o=function(r){return function(e,t,n){return{type:r,payload:{code:e,params:{path:t,query:n}}}}},u={push:o("@@router/PUSH"),replace:o("@@router/REPLACE"),goBack:function(r){return void 0===r&&(r=1),{type:"@@router/GO_BACK",payload:r}},goForward:function(r){return void 0===r&&(r=1),{type:"@@router/GO_FORWARD",payload:r}}},a="@@router/ROUTE_FOUND",i=Object.assign(function(r){return{type:a,payload:Object.assign({found:!0},r)}},{type:a});function c(r,t){return function(n){var o=r.window||window;if(o&&o.location&&o.location.pathname){var u,a=t.getState(n.getState()).routes.array.find(function(r){return console.log({r:r,pathname:o.location.pathname}),!!(u=r.href.regexp.exec(o.location.pathname))});if(console.log({route:a}),!a)return;u=a.href.parsed.map(function(r){return r.name}).filter(Boolean).reduce(function(r,t,n){return Object.assign(((e={})[t]=u[n+1],e),r)},{}),n.dispatch(i({route:a,params:{path:u,query:function(r){var e=r.location;if(e.search.length<2)return{};var t=e.search.substring(1);return JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}(o)}}))}}}function s(r,e){var t=r.history;return function(r){return function(n){var o,u=n.type,a=n.payload;switch(u){case"@@router/GO_FORWARD":return void t.go(a);case"@@router/GO_BACK":return void t.go(-1*a);case"@@router/REPLACE":case"@@router/PUSH":var c=a.code,s=a.params,f=e.getState(r.getState()).routes.map[c];if(f){var p=f.href,d="",l=p.base;p.compiled&&(l=p.compiled(s.path)),s.query&&(d="?"+(o=s.query,Object.keys(o).map(function(r){return encodeURIComponent(r)+"="+encodeURIComponent(o[r])}).join("&"))),l=""+l+d,"@@router/PUSH"===u?t.pushState(void 0,void 0,l):t.replaceState(void 0,void 0,l)}return i({route:f,params:s});default:return}}}}function f(r){var e=function(e){return r(e).result},t=function(r){return e(r).route},n=function(r){return e(r).params},o=function(r){return n(r).path},u=function(r){return n(r).query},a=function(r){return function(e){return o(e)[r]}},i=function(r){return function(e){return u(e)[r]}};return{getState:r,getRoute:function(e){return function(t){return r(t).routes.map[e]}},getResult:e,getCurrentCode:function(r){return t(r).code},getCurrentRoute:t,isFound:function(r){return e(r).found},getParams:n,getPathParams:o,getQueryParams:u,getPathParam:a,getQueryParam:i,getParam:function(r){return function(e){return a(r)(e)||i(r)(e)}}}}function p(){return{type:"@@router/INIT"}}function d(r){return"object"==typeof r&&r.code}var l={history:window&&window.history};export default function(e,o){void 0===o&&(o=l);var a=Object.assign({},l,o);if(!a.history)throw new Error("[k-redux-router] no history implementation is given");var g={array:function(e){var n=[],o=function(e,u,a){var i={};u&&(i=Object.entries(u).filter(function(r){return!d(r[1])}).reduce(function(r,e){return Object.assign(r,((t={})[e[0]]=e[1],t))},{}));var c=a;u&&(c=Object.assign(i,a,{parent:u&&u.code,href:{base:e,compiled:e.includes(":")?r.compile(e):void 0,regexp:r(e),parsed:r.parse(e)}}),n.push(c)),Object.entries(a).filter(function(r){return d(r[1])}).forEach(function(r){var t=r[1];return o([e,r[0]].join("").replace("//","/"),c,t)})};return o("",void 0,e),n.forEach(function(r){Object.entries(r).forEach(function(e){var t=e[0],n=e[1],o=n;d(n)&&(o=n.code),r[t]=o})}),n}(e)};g.map=g.array.reduce(function(r,e){return Object.assign({},r,((n={})[e.code]=e,n))},{});var v=function(r,e){void 0===e&&(e={});var t=Object.assign({},{routes:r,result:{found:!1}}),n=function(r,e){void 0===r&&(r=t),void 0===e&&(e={});var n=e.payload;switch(e.type){case"@@router/ROUTE_FOUND":return Object.assign({},r,{result:n});default:return r}};return Object.assign(n,f(e.getState||function(r){return r.ui.router})),Object.assign(n,u),n}(g,a);return{middleware:function(r,e,t){var n=!1,o=c(e,t),u=s(e,t);return function(r){return function(e){return function(t){if(!t.type||!t.type.startsWith("@@router/"))return e(t);var a=e(t);"@@router/INIT"===t.type&&(o(r),n?console.warn("[k-redux-router] initialized twice"):(n=!0,window.onpopstate=function(){o(r)})),n||t.type===i.type||console.warn("[k-redux-router] router should be initialized");var c=u(r)(t);return c&&r.dispatch(c),a}}}}(0,a,v),reducer:v,init:p}};export{u as actions,f as selectors};
//# sourceMappingURL=index.es.js.map
