!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("path-to-regexp")):"function"==typeof define&&define.amd?define(["exports","path-to-regexp"],t):t(e.core={},e.pathToRegexp)}(this,function(e,t){t=t&&t.hasOwnProperty("default")?t.default:t;var r,n,o,u=function(e){return function(t,r,n){return{type:e,payload:{code:t,params:{path:r,query:n}}}}},a={push:u("@@router/PUSH"),replace:u("@@router/REPLACE"),goBack:function(e){return void 0===e&&(e=1),{type:"@@router/GO_BACK",payload:e}},goForward:function(e){return void 0===e&&(e=1),{type:"@@router/GO_FORWARD",payload:e}}},i="@@router/ROUTE_FOUND",c=Object.assign(function(e){return{type:i,payload:Object.assign({found:!0},e)}},{type:i});function f(e){return function(t){if(window&&window.location&&window.location.pathname){var n,o=e.getState(t.getState()).routes.array.find(function(e){return!!(n=e.href.regexp.exec(window.location.pathname))});n=o.href.parsed.map(function(e){return e.name}).filter(Boolean).reduce(function(e,t,o){return Object.assign(((r={})[t]=n[o+1],r),e)},{}),t.dispatch(c({route:o,params:{path:n,query:function(){var e=window.location;if(e.search.length<2)return{};var t=e.search.substring(1);return JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}()}}))}}}function s(e,t){var r=e.history;return function(e){return function(n){var o,u=n.type,a=n.payload;switch(u){case"@@router/GO_FORWARD":return void r.go(a);case"@@router/GO_BACK":return void r.go(-1*a);case"@@router/REPLACE":case"@@router/PUSH":var i=a.code,f=a.params,s=t.getState(e.getState()).routes.map[i];if(s){var d=s.href,p="",l=d.base;d.compiled&&(l=d.compiled(f.path)),f.query&&(p="?"+(o=f.query,Object.keys(o).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])}).join("&"))),l=""+l+p,"@@router/PUSH"===u?r.pushState(void 0,void 0,l):r.replaceState(void 0,void 0,l)}return c({route:s,params:f});default:return}}}}function d(e){var t=function(t){return e(t).result},r=function(e){return t(e).route},n=function(e){return t(e).params},o=function(e){return n(e).path},u=function(e){return n(e).query},a=function(e){return function(t){return o(t)[e]}},i=function(e){return function(t){return u(t)[e]}};return{getState:e,getRoute:function(t){return function(r){return e(r).routes.map[t]}},getResult:t,getCurrentCode:function(e){return r(e).code},getCurrentRoute:r,isFound:function(e){return t(e).found},getParams:n,getPathParams:o,getQueryParams:u,getPathParam:a,getQueryParam:i,getParam:function(e){return function(t){return a(e)(t)||i(e)(t)}}}}function p(){return{type:"@@router/INIT"}}function l(e){return"object"==typeof e&&e.code}var g={history:window&&window.history};e.actions=a,e.default=function(e,r){void 0===r&&(r=g);var u=Object.assign({},g,r);if(!u.history)throw new Error("[k-redux-router] no history implementation is given");var i={array:function(e){var r=[],o=function(e,u,a){var i={};u&&(i=Object.entries(u).filter(function(e){return!l(e[1])}).reduce(function(e,t){return Object.assign(e,((n={})[t[0]]=t[1],n))},{}));var c=a;u&&(c=Object.assign(i,a,{parent:u&&u.code,href:{base:e,compiled:e.includes(":")?t.compile(e):void 0,regexp:t(e),parsed:t.parse(e)}}),r.push(c)),Object.entries(a).filter(function(e){return l(e[1])}).forEach(function(t){var r=t[1];return o([e,t[0]].join("").replace("//","/"),c,r)})};return o("",void 0,e),r.forEach(function(e){Object.entries(e).forEach(function(t){var r=t[0],n=t[1],o=n;l(n)&&(o=n.code),e[r]=o})}),r}(e)};i.map=i.array.reduce(function(e,t){return Object.assign({},e,((o={})[t.code]=t,o))},{});var y=function(e,t){void 0===t&&(t={});var r=Object.assign({},{routes:e,result:{found:!1}}),n=function(e,t){void 0===e&&(e=r),void 0===t&&(t={});var n=t.payload;switch(t.type){case"@@router/ROUTE_FOUND":return Object.assign({},e,{result:n});default:return e}};return Object.assign(n,d(t.getState||function(e){return e.ui.router})),Object.assign(n,a),n}(i,u);return{middleware:function(e,t,r){var n=!1,o=f(r),u=s(t,r);return function(e){return function(t){return function(r){if(!r.type||!r.type.startsWith("@@router/"))return t(r);var a=t(r);"@@router/INIT"===r.type&&(o(e),n?console.warn("[k-redux-router] initialized twice"):(n=!0,window.onpopstate=function(){o(e)})),n||r.type===c.type||console.warn("[k-redux-router] router should be initialized");var i=u(e)(r);return i&&e.dispatch(i),a}}}}(0,u,y),reducer:y,init:p}},e.selectors=d});
//# sourceMappingURL=index.umd.js.map
