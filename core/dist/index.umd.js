!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("path-to-regexp")):"function"==typeof define&&define.amd?define(["exports","path-to-regexp"],r):r(e.core={},e.pathToRegexp)}(this,function(e,r){r=r&&r.hasOwnProperty("default")?r.default:r;var t,n,o,u=function(e){return function(r,t,n){return{type:e,payload:{code:r,params:{path:t,query:n}}}}},a={push:u("@@router/PUSH"),replace:u("@@router/REPLACE"),goBack:function(e){return void 0===e&&(e=1),{type:"@@router/GO_BACK",payload:e}},goForward:function(e){return void 0===e&&(e=1),{type:"@@router/GO_FORWARD",payload:e}}},i="@@router/ROUTE_FOUND",c=Object.assign(function(e){return{type:i,payload:Object.assign({found:!0},e)}},{type:i});function f(e,r){return function(n){var o=e.location;if(o.pathname){var u,a=r.getState(n.getState()).routes.array.find(function(e){return!!(u=e.href.regexp.exec(o.pathname))});if(!a)return;u=a.href.parsed.map(function(e){return e.name}).filter(Boolean).reduce(function(e,r,n){return Object.assign(((t={})[r]=u[n+1],t),e)},{}),n.dispatch(c({route:a,params:{path:u,query:function(e){if(e.search.length<2)return{};var r=e.search.substring(1);return JSON.parse('{"'+decodeURI(r).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}(o)}}))}}}function s(e,r){var t=e.history;return function(e){return function(n){var o,u=n.type,a=n.payload;switch(u){case"@@router/GO_FORWARD":return void t.go(a);case"@@router/GO_BACK":return void t.go(-1*a);case"@@router/REPLACE":case"@@router/PUSH":var i=a.code,f=a.params;void 0===f&&(f={});var s=r.getState(e.getState()).routes.map[i];if(s){var p=s.href,d={};f&&f.path&&p.parsed&&p.parsed.filter(function(e){return"object"==typeof e}).map(function(e){return e.name}).filter(function(e){return f.path[e]}).forEach(function(e){d[e]=f.path[e]});var l="",g=p.base;p.compiled&&(g=p.compiled(d)),f.query&&(l="?"+(o=f.query,Object.keys(o).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])}).join("&"))),g=""+g+l,"@@router/PUSH"===u?t.pushState(void 0,void 0,g):t.replaceState(void 0,void 0,g);var h=Object.assign({},f);return f&&f.path&&(h.path=d),c({route:s,params:h})}return;default:return}}}}function p(e){var r=function(r){return e(r).result},t=function(e){return r(e).route},n=function(e){return function(r){return t(r)[e]}},o=function(e){return r(e).params},u=function(e){return o(e).path},a=function(e){return o(e).query},i=function(e){return function(r){var t=u(r);if(t)return t[e]}},c=function(e){return function(r){if(a(r))return a(r)[e]}};return{getState:e,getRoute:function(r){return function(t){return e(t).routes.map[r]}},getResult:r,getCurrentCode:function(e){return t(e).code},getCurrentRoute:t,isFound:function(e){return r(e).found},getResultParam:n,getParams:o,getPathParams:u,getQueryParams:a,getPathParam:i,getQueryParam:c,getParam:function(e){return function(r){return n(e)(r)||i(e)(r)||c(e)(r)}}}}function d(){return{type:"@@router/INIT"}}function l(e){return!("object"!=typeof e||!e.code)}var g={history:window&&window.history,location:window&&window.location};e.actions=a,e.router=function(e,t){void 0===t&&(t=g);var u=Object.assign({},g,t);if(!u.history)throw new Error("[k-redux-router] no history implementation is given");if(!u.location)throw new Error("[k-redux-router] no location implementation is given");var i={array:function(e){var t=[],o=function(e,u,a){var i={};u&&(i=Object.entries(u).filter(function(e){return!l(e[1])}).reduce(function(e,r){return Object.assign(e,((n={})[r[0]]=r[1],n))},{}));var c=a;u&&(c=Object.assign(i,a,{parent:u&&u.code,href:{base:e,compiled:e.includes(":")?r.compile(e):void 0,regexp:r(e),parsed:r.parse(e)}}),t.push(c)),Object.entries(a).filter(function(e){return l(e[1])}).forEach(function(r){var t=r[1];return o([e,r[0]].join("").replace("//","/"),c,t)})};return o("",void 0,e),t.forEach(function(e){Object.entries(e).forEach(function(r){var t=r[0],n=r[1],o=n;l(n)&&(o=n.code),e[t]=o})}),t}(e)};i.map=i.array.reduce(function(e,r){return Object.assign({},e,((o={})[r.code]=r,o))},{});var h=function(e,r){void 0===r&&(r={});var t=Object.assign({},{routes:e,result:{found:!1}}),n=function(e,r){void 0===e&&(e=t),void 0===r&&(r={});var n=r.payload;switch(r.type){case"@@router/ROUTE_FOUND":return Object.assign({},e,{result:n});default:return e}};return Object.assign(n,p(r.getState||function(e){return e.ui.router})),Object.assign(n,a),n}(i,u);return{middleware:function(e,r,t){var n=!1,o=f(r,t),u=s(r,t);return function(e){return function(r){return function(t){if(!t.type||!t.type.startsWith("@@router/"))return r(t);var a=r(t);"@@router/INIT"===t.type&&(o(e),n?console.warn("[k-redux-router] initialized twice"):(n=!0,window&&(window.onpopstate=function(){o(e)}))),n||t.type===c.type||console.warn("[k-redux-router] router should be initialized");var i=u(e)(t);return i&&e.dispatch(i),a}}}}(0,u,h),reducer:h,init:d}},e.selectors=p});
